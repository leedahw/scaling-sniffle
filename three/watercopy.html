<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>ThreeJS Model</title>

        <script src="js/THREEx.WindowResize.js"></script>
        <script src="js/THREEx.FullScreen.js"></script>


        <script type="module">

        // Find the latest version by visiting https://unpkg.com/three. The URL will
        // redirect to the newest stable release.
        import * as THREE from 'https://unpkg.com/three/build/three.module.js';
        import {OrbitControls} from 'https://unpkg.com/three/examples/jsm/controls/OrbitControls.js';
        import {GLTFLoader} from 'https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js';
        import { Refractor } from 'https://unpkg.com/three/examples/jsm/objects/Refractor.js';
        import { WaterRefractionShader } from 'https://unpkg.com/three/examples/jsm/shaders/WaterRefractionShader.js';

        let scene, camera, clock, renderer, refractor;

init();

function init() {

    // scene

    scene = new THREE.Scene();

    // camera

    camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 200 );
    camera.position.set( - 10, 0, 15 );
    camera.lookAt( scene.position );

    // clock

    clock = new THREE.Clock();

    // mesh

    const geometry = new THREE.TorusKnotGeometry( 3, 1, 256, 32 );
    const material = new THREE.MeshStandardMaterial( { color: 0x6083c2 } );

    const mesh = new THREE.Mesh( geometry, material );
    scene.add( mesh );

    // refractor

    const refractorGeometry = new THREE.PlaneGeometry( 10, 10 );

    refractor = new Refractor( refractorGeometry, {
        color: 0x999999,
        textureWidth: 1024,
        textureHeight: 1024,
        shader: WaterRefractionShader
    } );

    refractor.position.set( 0, 0, 5 );

    scene.add( refractor );

    // load dudv map for distortion effect

    const dudvMap = new THREE.TextureLoader().load( 'images/waterdudv.jpg', function () {

        animate();

    } );

    dudvMap.wrapS = dudvMap.wrapT = THREE.RepeatWrapping;
    refractor.material.uniforms[ "tDudv" ].value = dudvMap;

    // light

    const ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
    scene.add( ambientLight );

    const pointLight = new THREE.PointLight( 0xffffff, 0.8 );
    camera.add( pointLight );
    scene.add( camera );

    // renderer

    renderer = new THREE.WebGLRenderer( { antialias: true } );
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setClearColor( 0x20252f );
    renderer.setPixelRatio( window.devicePixelRatio );
    document.body.appendChild( renderer.domElement );

    //

    const controls = new OrbitControls( camera, renderer.domElement );
    controls.minDistance = 10;
    controls.maxDistance = 100;

    //

    window.addEventListener( 'resize', onWindowResize );

}

function onWindowResize() {

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize( window.innerWidth, window.innerHeight );

}

function animate() {

    requestAnimationFrame( animate );

    render();

}

function render() {

    refractor.material.uniforms[ "time" ].value += clock.getDelta();

    renderer.render( scene, camera );

}
        </script>
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<style>
		body {margin:0px;}
		canvas {width:100%; height:100%;}
		</style>

    </head>
    <body>

    </body>
</html>
